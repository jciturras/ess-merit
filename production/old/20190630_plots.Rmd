---
author: "Julio Iturra - jciturra@uc.cl"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r librerias, message=FALSE, warning=FALSE, include=FALSE}
library(lavaan)
library(dplyr)
library(knitr)
library(texreg)
library(ggplot2)
library(here)
```

```{r base de datos, message=FALSE, warning=FALSE, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
rm(list=ls())
load(here("data","ELSOC_ess_merit2018.RData"))
elsoc_gini <- elsoc_18 %>% select(d05_02, d05_03, d05_04, c18_09, c18_10,
                                  ID02,ID03,ID04,ID05,ID06,ID07,ID08,ID09,ID10,IDNR,
                                 ecin0,ecin1.2,ecin3.4,ecin5,ecin6.7.8,
                                 isco09,isco08,isco07,isco06,isco05,isco04,isco03,isco02,isco01,isco_nr,
                                 ess,essfam,esshijos,
                                 ppol_izq,ppol_cen,ppol_der,ppol_ind,ppol_ninguno,sexo,edad) %>% na.omit()
```

```{r custom texreg, include=FALSE}
nota  <- c("\\parbox{.8\\linewidth}{\\vspace{2pt} Valores $z$ entre paréntesis, Coeficientes de regresión no estandarizados   \\\\ 
          $^{***}p<0.001$, $^{**}p<0.01$, $^*p<0.05$.}")
nota2 <- c("\\parbox{.9\\linewidth}{\\vspace{2pt} Valores $z$ entre paréntesis, Coeficientes de regresión no estandarizados   \\\\ 
          $^{***}p<0.001$, $^{**}p<0.01$, $^*p<0.05$. \\\\
          \\textbf{\\textit{Nota}}: No se muestran los coeficientes de la categoría ``No responde`` para Ingreso y Ocupación}")

nota3 <- c("\\parbox{1.4\\linewidth}{\\vspace{2pt} Valores $z$ entre paréntesis, Coeficientes de regresión no estandarizados   \\\\ 
          $^{***}p<0.001$, $^{**}p<0.01$, $^*p<0.05$. \\\\
          \\textbf{\\textit{Nota}}: No se muestran los coeficientes de la categoría ``No responde`` para Ingreso y Ocupación. Se excluyen los coeficientes de los controles Sexo, Edad y Posición política.}")
ajuste <- c("\\textbf{$\\chi^2$}","\\textbf{gl}","\\textbf{CFI}","\\textbf{RMSEA}","\\textbf{Num. obs.}")
```

#Modelo Estatus subjetivo

```{r MODELO ESS, message=FALSE, warning=FALSE, include=FALSE, cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem.ess1<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ess
recompe~ess
'
fit.ess1 <-sem(sem.ess1,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))

salirad.ess1 <- as.data.frame(parameterEstimates(fit.ess1)[6,])
recompe.ess1 <- as.data.frame(parameterEstimates(fit.ess1)[7,])
fit.mesess1 <- fitMeasures(fit.ess1,c("chisq","df","pvalue","cfi","rmsea"))

#----Crear la tabla-----
m1salir <- texreg::createTexreg(coef.names = salirad.ess1$rhs ,
                     coef =salirad.ess1$est,
                     se = salirad.ess1$z,
                     pvalues = salirad.ess1$pvalue,
                     gof = c(fitmeasures(fit.ess1)[[c(3)]],
                             fitmeasures(fit.ess1)[[c(4)]],
                             fitmeasures(fit.ess1)[[c(18)]],
                             fitmeasures(fit.ess1)[[c(36)]],
                             nobs(fit.ess1)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m1reco <- texreg::createTexreg(coef.names = recompe.ess1$rhs ,
                     coef =recompe.ess1$est,
                     se = recompe.ess1$z,
                     pvalues = recompe.ess1$pvalue,
                     gof = c(fitmeasures(fit.ess1)[[c(3)]],
                             fitmeasures(fit.ess1)[[c(4)]],
                             fitmeasures(fit.ess1)[[c(18)]],
                             fitmeasures(fit.ess1)[[c(36)]],
                             nobs(fit.ess1)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
```

```{r MODELO ESS+ESSfam , message=FALSE, warning=FALSE, include=FALSE, cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem.ess2<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ess + essfam
recompe~ess + essfam
'
fit.ess2 <-sem(sem.ess2,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))

# x <-  parameterEstimates(fit.ess2) #Para saber la posición de las filas
salirad.ess2 <- as.data.frame(parameterEstimates(fit.ess2)[6:7, ])
recompe.ess2 <- as.data.frame(parameterEstimates(fit.ess2)[8:9, ])
fit.mesess2 <- fitMeasures(fit.ess2,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m2salir <- texreg::createTexreg(coef.names  = salirad.ess2$rhs ,
                                       coef = salirad.ess2$est,
                                         se = salirad.ess2$z,
                                    pvalues = salirad.ess2$pvalue,
                     gof = c(fitmeasures(fit.ess2)[[c(3)]],
                             fitmeasures(fit.ess2)[[c(4)]],
                             fitmeasures(fit.ess2)[[c(18)]],
                             fitmeasures(fit.ess2)[[c(36)]],
                             nobs(fit.ess2)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m2reco <- texreg::createTexreg(coef.names = recompe.ess2$rhs ,
                     coef =recompe.ess2$est,
                     se = recompe.ess2$z,
                     pvalues = recompe.ess2$pvalue,
                     gof = c(fitmeasures(fit.ess2)[[c(3)]],
                             fitmeasures(fit.ess2)[[c(4)]],
                             fitmeasures(fit.ess2)[[c(18)]],
                             fitmeasures(fit.ess2)[[c(36)]],
                             nobs(fit.ess2)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
```

```{r MODELO ESS FULL, message=FALSE, warning=FALSE, include=FALSE, cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem.ess3<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ess + essfam + esshijos
recompe~ess + essfam + esshijos
'
fit.ess3 <-sem(sem.ess3,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))

salirad.ess3 <- as.data.frame(parameterEstimates(fit.ess3)[6:8, ])
recompe.ess3 <- as.data.frame(parameterEstimates(fit.ess3)[9:11, ])
fit.mesess3 <- fitMeasures(fit.ess3,c("chisq","df","pvalue","cfi","rmsea"))

#----Crear la tabla-----
m3salir <- texreg::createTexreg(coef.names  = salirad.ess3$rhs ,
                                       coef = salirad.ess3$est,
                                         se = salirad.ess3$z,
                                    pvalues = salirad.ess3$pvalue,
                     gof = c(fitmeasures(fit.ess3)[[c(3)]],
                             fitmeasures(fit.ess3)[[c(4)]],
                             fitmeasures(fit.ess3)[[c(18)]],
                             fitmeasures(fit.ess3)[[c(36)]],
                                    nobs(fit.ess3)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m3reco <-  texreg::createTexreg(coef.names  = recompe.ess3$rhs ,
                                       coef = recompe.ess3$est,
                                         se = recompe.ess3$z,
                                    pvalues = recompe.ess3$pvalue,
                     gof = c(fitmeasures(fit.ess3)[[c(3)]],
                             fitmeasures(fit.ess3)[[c(4)]],
                             fitmeasures(fit.ess3)[[c(18)]],
                             fitmeasures(fit.ess3)[[c(36)]],
                                    nobs(fit.ess3)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))

```

```{r MODELO FAM+HIJOS, message=FALSE, warning=FALSE, include=FALSE, cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem.ess33<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ essfam + esshijos
recompe~ essfam + esshijos
'
fit.ess33 <-sem(sem.ess33,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))

salirad.ess33 <- as.data.frame(parameterEstimates(fit.ess33)[6:7, ])
recompe.ess33 <- as.data.frame(parameterEstimates(fit.ess33)[8:9, ])
fit.mesess33 <- fitMeasures(fit.ess33,c("chisq","df","pvalue","cfi","rmsea"))

#----Crear la tabla-----
m33salir <- texreg::createTexreg(coef.names = salirad.ess33$rhs ,
                                       coef = salirad.ess33$est,
                                         se = salirad.ess33$z,
                                    pvalues = salirad.ess33$pvalue,
                     gof = c(fitmeasures(fit.ess33)[[c(3)]],
                             fitmeasures(fit.ess33)[[c(4)]],
                             fitmeasures(fit.ess33)[[c(18)]],
                             fitmeasures(fit.ess33)[[c(36)]],
                                    nobs(fit.ess33)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m33reco <-  texreg::createTexreg(coef.names = recompe.ess33$rhs ,
                                       coef = recompe.ess33$est,
                                         se = recompe.ess33$z,
                                    pvalues = recompe.ess33$pvalue,
                     gof = c(fitmeasures(fit.ess33)[[c(3)]],
                             fitmeasures(fit.ess33)[[c(4)]],
                             fitmeasures(fit.ess33)[[c(18)]],
                             fitmeasures(fit.ess33)[[c(36)]],
                                    nobs(fit.ess33)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))

```

```{r tabla-latex-modelo123, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos123 <- list(m1salir,m1reco,m2salir,m2reco,m3salir,m3reco)
coefm123 <- c("Estatus subjetivo propio", "Estatus subjetivo familia","Estatus subjetivo hijos")
nombres <- c("(1)","(2)",
             "(1)","(2)",
             "(1)","(2)")
test2<- texreg(modelos123, center = TRUE,
       custom.coef.names = coefm123, 
       custom.model.names = nombres,
       dcolumn = TRUE,
       booktabs = TRUE,
       use.packages = FALSE,
       single.row = FALSE,
       digits = 3,
       sideways = FALSE,
       no.margin = FALSE,scalebox = 0.75,
       caption.above = TRUE, 
       caption = "Coeficientes de regresión no estandarizados de Estatus subjetivo sobre las variables latentes Salir adelante (1) y Recompensa percibida (2)",
       custom.note = nota,
       float.pos = "h!",label = "table:ess123")
# R.utils::captureOutput(test2, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/regres123.tex")
```

# Modelo Estatus objetivo

```{r MODELO Educación, message=FALSE, warning=FALSE, include=FALSE, cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem.educ<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ecin1.2+ecin3.4+ecin5+ecin6.7.8
recompe~ecin1.2+ecin3.4+ecin5+ecin6.7.8
'
fit.sem.educ <-sem(sem.educ,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))
 
salirad.educ  <- as.data.frame(parameterEstimates(fit.sem.educ)[6:9, ])
recompe.educ  <- as.data.frame(parameterEstimates(fit.sem.educ)[10:13, ])
fit.messem.educ <- fitMeasures(fit.sem.educ,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m4salir <- texreg::createTexreg(coef.names  = salirad.educ$rhs ,
                                       coef = salirad.educ$est,
                                         se = salirad.educ$z,
                                    pvalues = salirad.educ$pvalue,
                     gof = c(fitmeasures(fit.sem.educ)[[c(3)]],
                             fitmeasures(fit.sem.educ)[[c(4)]],
                             fitmeasures(fit.sem.educ)[[c(18)]],
                             fitmeasures(fit.sem.educ)[[c(36)]],
                                    nobs(fit.sem.educ)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m4reco <-  texreg::createTexreg(coef.names  = recompe.educ$rhs ,
                                       coef = recompe.educ$est,
                                         se = recompe.educ$z,
                                    pvalues = recompe.educ$pvalue,
                     gof = c(fitmeasures(fit.sem.educ)[[c(3)]],
                             fitmeasures(fit.sem.educ)[[c(4)]],
                             fitmeasures(fit.sem.educ)[[c(18)]],
                             fitmeasures(fit.sem.educ)[[c(36)]],
                                    nobs(fit.sem.educ)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))

```

```{r MODELO Ingresos, include=FALSE, cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem.inc<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR
recompe~ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR
'
fit.sem.inc <-sem(sem.inc,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))

# x <-  parameterEstimates(fit.sem.inc) #Para saber la posición de las filas
salirad.inc <- as.data.frame(parameterEstimates(fit.sem.inc)[6:15,  ])
recompe.inc <- as.data.frame(parameterEstimates(fit.sem.inc)[16:25, ])
fit.messem.inc <- fitMeasures(fit.sem.inc,c("chisq","df","pvalue","cfi","rmsea"))
#----Crear la tabla-----
m5salir <- texreg::createTexreg(coef.names  = salirad.inc$rhs ,
                                       coef = salirad.inc$est,
                                         se = salirad.inc$z,
                                    pvalues = salirad.inc$pvalue,
                     gof = c(fitmeasures(fit.sem.inc)[[c(3)]],
                             fitmeasures(fit.sem.inc)[[c(4)]],
                             fitmeasures(fit.sem.inc)[[c(18)]],
                             fitmeasures(fit.sem.inc)[[c(36)]],
                                    nobs(fit.sem.inc)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m5reco <-  texreg::createTexreg(coef.names  = recompe.inc$rhs ,
                                       coef = recompe.inc$est,
                                         se = recompe.inc$z,
                                    pvalues = recompe.inc$pvalue,
                     gof = c(fitmeasures(fit.sem.inc)[[c(3)]],
                             fitmeasures(fit.sem.inc)[[c(4)]],
                             fitmeasures(fit.sem.inc)[[c(18)]],
                             fitmeasures(fit.sem.inc)[[c(36)]],
                                    nobs(fit.sem.inc)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
```

```{r MODELO Ocupacion, include=FALSE, cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem.isco<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr
recompe~isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr
'
fit.sem.isco <-sem(sem.isco,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))

salirad.isco <- as.data.frame(parameterEstimates(fit.sem.isco)[6:14, ])
recompe.isco <- as.data.frame(parameterEstimates(fit.sem.isco)[15:23,])
fit.messem.isco <- fitMeasures(fit.sem.isco,c("chisq","df","pvalue","cfi","rmsea"))

#----Crear la tabla-----
m6salir <- texreg::createTexreg(coef.names  = salirad.isco$rhs ,
                                       coef = salirad.isco$est,
                                         se = salirad.isco$z,
                                    pvalues = salirad.isco$pvalue,
                     gof = c(fitmeasures(fit.sem.isco)[[c(3)]],
                             fitmeasures(fit.sem.isco)[[c(4)]],
                             fitmeasures(fit.sem.isco)[[c(18)]],
                             fitmeasures(fit.sem.isco)[[c(36)]],
                                    nobs(fit.sem.isco)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m6reco <-  texreg::createTexreg(coef.names  = recompe.isco$rhs ,
                                       coef = recompe.isco$est,
                                         se = recompe.isco$z,
                                    pvalues = recompe.isco$pvalue,
                     gof = c(fitmeasures(fit.sem.isco)[[c(3)]],
                             fitmeasures(fit.sem.isco)[[c(4)]],
                             fitmeasures(fit.sem.isco)[[c(18)]],
                             fitmeasures(fit.sem.isco)[[c(36)]],
                                    nobs(fit.sem.isco)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
```

```{r tabla-latex-modelo-est-objetivo, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos456 <- list(m4salir,m4reco,m5salir,m5reco,m6salir,m6reco)

coefm456 <- c("Primaria y secundaria baja","Secundaria alta","Terciaria ciclo corto","Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "No responde - Decil",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
              "No responde - Ocupación")

coefm456 <- c("Primaria y secundaria baja","Secundaria alta","Terciaria ciclo corto","Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes")

refm456 <- list("\\textbf{Educación (ref: Primaria incompleta o menos)}" = 1:4 ,
              "\\textbf{Ingresos (ref: Decil 1)}" = 5:12,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=13:20)

texreg(modelos456, center = FALSE,
       custom.coef.names = coefm456,
       single.row = TRUE,
       dcolumn = FALSE,
       booktabs = TRUE,
       use.packages = FALSE,
       digits = 2,
       sideways = FALSE,
       no.margin = FALSE,
       scalebox = 0.66,
       caption.above = TRUE,
       custom.note = nota2,
       float.pos = "h!",
       groups = refm456,
       omit.coef = "(IDNR)|(isco_nr)",
       caption = "Coeficientes de regresión no estandarizados de Estatus objetivo sobre las variables latentes Salir adelante (1) y Recompensa percibida (2)")
```

#Modelo Estatus subjetivo PROPIO, objetivo y controles.

```{r ESS propio + Objetivos + controles}
sem.ess1.obj<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ess+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
recompe~ess+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR + isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
'
fit.sem.esobj <-sem(sem.ess1.obj,data=elsoc_gini,
                    ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))
summary(fit.sem.esobj)

salirad.est <- as.data.frame(parameterEstimates(fit.sem.esobj)[6:35, ])
recompe.est <- as.data.frame(parameterEstimates(fit.sem.esobj)[36:65,])

s0est <- salirad.est
r0est <- recompe.est
#----Crear la tabla-----
m61salir <- texreg::createTexreg(coef.names = salirad.est$rhs ,
                                       coef = salirad.est$est,
                                         se = salirad.est$z,
                                    pvalues = salirad.est$pvalue,
                     gof = c(fitmeasures(fit.sem.esobj)[[c(3)]],
                             fitmeasures(fit.sem.esobj)[[c(4)]],
                             fitmeasures(fit.sem.esobj)[[c(18)]],
                             fitmeasures(fit.sem.esobj)[[c(36)]],
                                    nobs(fit.sem.esobj)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m61reco <-  texreg::createTexreg(coef.names = recompe.est$rhs ,
                                       coef = recompe.est$est,
                                         se = recompe.est$z,
                                    pvalues = recompe.est$pvalue,
                     gof = c(fitmeasures(fit.sem.esobj)[[c(3)]],
                             fitmeasures(fit.sem.esobj)[[c(4)]],
                             fitmeasures(fit.sem.esobj)[[c(18)]],
                             fitmeasures(fit.sem.esobj)[[c(36)]],
                                    nobs(fit.sem.esobj)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
```

#Modelo Estatus subjetivo DINAMICO, objetivo y controles.

```{r ESS familia e hijos + Objetivo + controles}
sem.ess2.obj<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~essfam+esshijos+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
recompe~essfam+esshijos+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR + isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
'
fit.sem.esobj2 <-sem(sem.ess2.obj,data=elsoc_gini,
                    ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))
# summary(fit.sem.esobj2)
salirad.est <- as.data.frame(parameterEstimates(fit.sem.esobj2)[6:36, ])
recompe.est <- as.data.frame(parameterEstimates(fit.sem.esobj2)[37:67,])
s0est <- salirad.est
r0est <- recompe.est
#----Crear la tabla-----
m62salir <- texreg::createTexreg(coef.names = salirad.est$rhs ,
                                       coef = salirad.est$est,
                                         se = salirad.est$z,
                                    pvalues = salirad.est$pvalue,
                     gof = c(fitmeasures(fit.sem.esobj2)[[c(3)]],
                             fitmeasures(fit.sem.esobj2)[[c(4)]],
                             fitmeasures(fit.sem.esobj2)[[c(18)]],
                             fitmeasures(fit.sem.esobj2)[[c(36)]],
                                    nobs(fit.sem.esobj2)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m62reco <-  texreg::createTexreg(coef.names = recompe.est$rhs ,
                                       coef = recompe.est$est,
                                         se = recompe.est$z,
                                    pvalues = recompe.est$pvalue,
                     gof = c(fitmeasures(fit.sem.esobj2)[[c(3)]],
                             fitmeasures(fit.sem.esobj2)[[c(4)]],
                             fitmeasures(fit.sem.esobj2)[[c(18)]],
                             fitmeasures(fit.sem.esobj2)[[c(36)]],
                                    nobs(fit.sem.esobj2)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
```

```{r tabla-subjetivo-objetivo-controles-modelo61, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos61 <- list(m61salir,m61reco)
coefm61 <- c("Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "No responde - Decil",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                     "No responde - ISCO",
                     "Centro",
                     "Derecha/Centro Derecha",
                     "Independiente",
                     "Ninguno",
                     "Mujer",
                     "Edad")
refm61 <- list("\\textbf{Educación (ref: Primaria incompleta o menos)}" = 4:7 ,
              "\\textbf{Ingresos (ref: Decil 1)}" = 8:16,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=17:24,
              "\\textbf{Posición política (ref: Izquierda/centro Izquierda)}"=25:30)

texreg(modelos61)
# texreg(modelos61, center = TRUE,
#        custom.coef.names = coefm7,
#        dcolumn = TRUE,
#        booktabs = TRUE,
#        use.packages = FALSE,
#        single.row = FALSE,digits = 2,
#        sideways = FALSE,
#        no.margin = FALSE,scalebox = 0.60,
#        caption.above = TRUE,
#        custom.note = nota2,
#        float.pos = "H",
#        groups = refm61,
#        caption = "Modelos de ecuaciones estructurales para el Estatus Social Subjetivo y Objetivo con las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
```

#Modelo Estatus subjetivo completo, objetivo y controles.

```{r MODELO subjetivo-objetivo-controles, message=FALSE, warning=FALSE, include=FALSE,cache=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
sem<-'
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
salirad~ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+ecin1.2+ecin3.4+ecin5+ecin6.7.8+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ess+essfam+esshijos+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
recompe~ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+ecin1.2+ecin3.4+ecin5+ecin6.7.8+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ess+essfam+esshijos+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
'
fit.sem <-sem(sem,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))
# summary(fit.sem)
salirad.est <- as.data.frame(parameterEstimates(fit.sem)[6:37, ])
recompe.est <- as.data.frame(parameterEstimates(fit.sem)[38:69,])

s1est <- salirad.est
r1est <- recompe.est
#----Crear la tabla-----
m7salir <- texreg::createTexreg(coef.names  = salirad.est$rhs ,
                                       coef = salirad.est$est,
                                         se = salirad.est$z,
                                    pvalues = salirad.est$pvalue,
                     gof = c(fitmeasures(fit.sem)[[c(3)]],
                             fitmeasures(fit.sem)[[c(4)]],
                             fitmeasures(fit.sem)[[c(18)]],
                             fitmeasures(fit.sem)[[c(36)]],
                                    nobs(fit.sem)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
m7reco <-  texreg::createTexreg(coef.names  = recompe.est$rhs ,
                                       coef = recompe.est$est,
                                         se = recompe.est$z,
                                    pvalues = recompe.est$pvalue,
                     gof = c(fitmeasures(fit.sem)[[c(3)]],
                             fitmeasures(fit.sem)[[c(4)]],
                             fitmeasures(fit.sem)[[c(18)]],
                             fitmeasures(fit.sem)[[c(36)]],
                                    nobs(fit.sem)),
                    gof.names = ajuste,
                    gof.decimal =c (TRUE, FALSE,TRUE, TRUE, FALSE))
``` 

```{r tabla-subjetivo-objetivo-controles-modelo7, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos7 <- list(m7salir,m7reco)
coefm7 <- c("Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9", 
                     "Decil 10",
                     "No responde - Decil",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                     "No responde - ISCO",
                      "Centro",
                     "Derecha/Centro Derecha",
                     "Independiente",
                     "Ninguno",
                     "Mujer",
                     "Edad")
# coefm7 <- c("Estatus Subjetivo propio",
#                      "Estatus Subjetivo familia",
#                      "Estatus Subjetivo hijos",
#                      "Primaria y secundaria baja",
#                      "Secundaria alta",
#                      "Terciaria ciclo corto",
#                      "Terciaria y Postgrado",
#                      "Decil 2",
#                      "Decil 3",
#                      "Decil 4",
#                      "Decil 5",
#                      "Decil 6",
#                      "Decil 7",
#                      "Decil 8",
#                      "Decil 9",
#                      "Decil 10",
#             
#                      "Operadores de instalaciones/maquina/ensamblaje",
#                      "Oficiales, operarios y artesanos",
#                      "Agricultores y trabajadores calificados",
#                      "Servicios y vendedores de comercios y mercados",
#                      "Personal de apoyo administrativo",
#                      "Técnicos y profesionales de nivel medio",
#                      "Profesionales científicos e intelectuales",
#                      "Directores y gerentes",
#                      
#                       "Centro",
#                      "Derecha/Centro Derecha",
#                      "Independiente",
#                      "Ninguno",
#                      "Mujer",
#                      "Edad")

refm7 <- list("\\textbf{Educación (ref: Primaria incompleta o menos)}" = 4:7 ,
              "\\textbf{Ingresos (ref: Decil 1)}" = 8:16,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=17:24,
              "\\textbf{Posición política (ref: Izquierda/centro Izquierda)}"=25:30)

texreg(modelos7, center = TRUE,
       custom.coef.names = coefm7,
       dcolumn = TRUE,
       booktabs = TRUE,
       use.packages = FALSE,
       single.row = FALSE,digits = 2,
       sideways = FALSE,
       no.margin = FALSE,scalebox = 0.60,
       caption.above = TRUE,
       custom.note = nota2,
       float.pos = "H",
       groups = refm7,
       caption = "Modelos de ecuaciones estructurales para el Estatus Social Subjetivo y Objetivo con las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
```

```{r tabla-subjetivo-objetivo-controles-completa, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos8 <- list(m4salir,m4reco,m5salir,m5reco,m6salir,m6reco,m3salir,m3reco,m7salir,m7reco)
# modelos8 <- list(m3salir,m4salir,m5salir,m6salir,m7salir,m3reco,m4reco,m5reco,m6reco,m7reco)
coefm7 <- c("Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "No responde - Decil",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                     "No responde - ISCO",
                      "Centro",
                     "Derecha/Centro Derecha",
                     "Independiente",
                     "Ninguno",
                     "Mujer",
                     "Edad")
# coefm7 <- c("Estatus Subjetivo propio",
#                      "Estatus Subjetivo familia",
#                      "Estatus Subjetivo hijos",
#                      "Primaria y secundaria baja",
#                      "Secundaria alta",
#                      "Terciaria ciclo corto",
#                      "Terciaria y Postgrado",
#                      "Decil 2",
#                      "Decil 3",
#                      "Decil 4",
#                      "Decil 5",
#                      "Decil 6",
#                      "Decil 7",
#                      "Decil 8",
#                      "Decil 9",
#                      "Decil 10",
#                      
#                      "Operadores de instalaciones/maquina/ensamblaje",
#                      "Oficiales, operarios y artesanos",
#                      "Agricultores y trabajadores calificados",
#                      "Servicios y vendedores de comercios y mercados",
#                      "Personal de apoyo administrativo",
#                      "Técnicos y profesionales de nivel medio",
#                      "Profesionales científicos e intelectuales",
#                      "Directores y gerentes",
#                      
#                       "Centro",
#                      "Derecha/Centro Derecha",
#                      "Independiente",
#                      "Ninguno",
#                      "Mujer",
#                      "Edad")

refm7 <- list("\\textbf{Educación (ref: Primaria incompleta o menos)}" = 4:7 ,
              "\\textbf{Ingresos (ref: Decil 1)}" = 8:17,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=18:26,
              "\\textbf{Posición política (ref: Izquierda/centro Izquierda)}"=27:30)
anexo1 <- texreg(modelos8, center = TRUE,
       custom.coef.names = coefm7,
       custom.model.names = c("(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)"),
       dcolumn = TRUE,
       booktabs = TRUE,
       use.packages = FALSE,
       single.row = FALSE,digits = 2,
       sideways = FALSE,
       no.margin = FALSE,scalebox = 0.54,
       caption.above = TRUE,
       custom.note = nota2,
       float.pos = "!htpb",
       groups = refm7,
       label = "tab:anexo1",
       caption = "Modelos de ecuaciones estructurales para el Estatus Social Subjetivo y Objetivo con las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")

# R.utils::captureOutput(anexo1, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/anexo1.tex")
```

```{r sin-NSNR, eval=FALSE, include=FALSE, results='asis'}
texreg(modelos8, center = TRUE,
       custom.coef.names = coefm7,
       custom.model.names = c("(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)"),
       dcolumn = FALSE,
       booktabs = TRUE,
       use.packages = FALSE,
       single.row = TRUE,digits = 2,
       sideways = TRUE,
       no.margin = FALSE,scalebox = 0.65,
       caption.above = TRUE,
       custom.note = nota2,
       float.pos = "!htpb",
       groups = refm7,
       omit.coef = "(IDNR)|(isco_nr)",
       caption = "Coeficientes de regresión no estandarizados de Estatus subjetivo y objetivo sobre las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
```

```{r sin-controles-sin-NSNR, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
coefm8 <- c("Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes")

refm8 <- list("\\textbf{Educación (ref: Primaria incompleta o menos)}" = 4:7 ,
              "\\textbf{Ingresos (ref: Decil 1)}" = 8:16,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=17:24)
test <- texreg(modelos8, center = TRUE,
          custom.coef.names = coefm8,
          custom.model.names = c("(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)"),
          dcolumn = TRUE,
          booktabs = TRUE,
          use.packages = FALSE,
          single.row = FALSE,digits = 3,
          sideways = FALSE,
          no.margin = TRUE,scalebox = 0.65,
          caption.above = TRUE,
          custom.note = nota3,
          float.pos = "!htpb",
          groups = refm8,
          label = "anexo1",
          omit.coef = "(IDNR)|(isco_nr)|(ppol_cen)|(ppol_der)|(ppol_ind)|(ppol_ninguno)|(sexo)|(edad)",
          caption = "Coeficientes de regresión no estandarizados de Estatus subjetivo y objetivo sobre las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
test
# R.utils::captureOutput(test, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/regres17.tex")
# R.utils::captureOutput(test, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/regres17b.tex")
```

```{r sin-controles-sin-NSNR-horiz, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
test <- texreg(modelos8, center = TRUE,
          custom.coef.names = coefm8,
          custom.model.names = c("(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)"),
          dcolumn = FALSE,
          booktabs = TRUE,
          use.packages = FALSE,
          single.row = TRUE,digits = 2,
          sideways = TRUE,
          no.margin = TRUE,scalebox = 0.6,
          caption.above = TRUE,
          custom.note = nota3,
          float.pos = "!htpb",
          groups = refm8,
          omit.coef = "(IDNR)|(isco_nr)|(ppol_cen)|(ppol_der)|(ppol_ind)|(ppol_ninguno)|(sexo)|(edad)",
          caption = "Coeficientes de regresión no estandarizados de Estatus subjetivo y objetivo sobre las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
test
```

#Modelos por orden de hipótesis

```{r sin-controles-sin-NSNR-ordenH1, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos9 <- list(m5salir,m5reco,m4salir,m4reco,m6salir,m6reco,m3salir,m3reco,m7salir,m7reco)

coefm9 <- c("Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                      "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                      "Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos")

refm9 <- list("\\textbf{Ingresos (ref: Decil 1)}" = 1:9,
              "\\textbf{Educación (ref: Primaria incompleta o menos)}" = 10:13 ,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=14:21)
test <- texreg(modelos9, center = TRUE,
          custom.coef.names = coefm9,
          custom.model.names = c("(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)"),
          dcolumn = TRUE,
          booktabs = TRUE,
          use.packages = FALSE,
          single.row = FALSE,digits = 3,
          sideways = FALSE,
          no.margin = TRUE,scalebox = 0.65,
          caption.above = TRUE,
          custom.note = nota3,
          float.pos = "!htpb",
          groups = refm9,
          label = "anexo1",
          omit.coef = "(IDNR)|(isco_nr)|(ppol_cen)|(ppol_der)|(ppol_ind)|(ppol_ninguno)|(sexo)|(edad)",
          caption = "Coeficientes de regresión no estandarizados de Estatus subjetivo y objetivo sobre las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
test
# R.utils::captureOutput(test, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/regres17.tex")
# R.utils::captureOutput(test, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/regres17b.tex")
```

```{r tabla-subjetivo-objetivo-controles-completa-ordenH1, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos10 <- list(m5salir,m5reco,m4salir,m4reco,m6salir,m6reco,m1salir,m1reco,m33salir,m33reco,m7salir,m7reco)
coefm10 <- c(
                     "Decil 2",
                     "Decil 3", 
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "No responde - Decil",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                     "No responde - ISCO",
                      "Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos",
                      "Centro",
                     "Derecha/Centro Derecha",
                     "Independiente",
                     "Ninguno",
                     "Mujer",
                     "Edad")
refm10 <- list("\\textbf{Ingresos (ref: Decil 1)}" = 1:10 ,
              "\\textbf{Educación (ref: Primaria incompleta o menos)}" = 11:14,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=15:23,
              "\\textbf{Estatus subjetivo}"=24:26,
              "\\textbf{Posición política (ref: Izquierda/centro Izquierda)}"=27:30)


anexo1 <- texreg(modelos10, center = TRUE,
       custom.coef.names = coefm10,
       custom.model.names = c("(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)","(1)","(2)"),
       dcolumn = TRUE,
       booktabs = TRUE,
       use.packages = FALSE,
       single.row = FALSE,digits = 2,
       sideways = FALSE,
       no.margin = FALSE,scalebox = 0.55,
       caption.above = TRUE,
       custom.note = nota,
       float.pos = "H",
       groups = refm10,
       label = "tab:anexo1b",
       caption = "Modelos de ecuaciones estructurales para el Estatus Social Subjetivo y Objetivo con las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
anexo1
# R.utils::captureOutput(anexo1, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/anexo1b.tex")
```

#Anexo Estatus subjetivo step-by-step

31 coef

```{r tabla-subjetivo-objetivo-controles-completa-ordenH1, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
modelos10 <- list(m61salir,m61reco,m62salir,m62reco,m7salir,m7reco)
coefm10 <- c("Estatus Subjetivo propio",
             "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3", 
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "No responde - Decil",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                     "No responde - ISCO",
                     "Centro",
                     "Derecha/Centro Derecha",
                     "Independiente",
                     "Ninguno",
                     "Mujer",
                     "Edad",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos")
refm10 <- list("\\textbf{Ingresos (ref: Decil 1)}" = 1:10 ,
              "\\textbf{Educación (ref: Primaria incompleta o menos)}" = 11:14,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=15:23,
              "\\textbf{Estatus subjetivo}"=24:26,
              "\\textbf{Posición política (ref: Izquierda/centro Izquierda)}"=27:30)

reorder <- c(6,7,8,9,10,11,12,13,14,15,2,3,4,5,16,17,18,19,20,21,22,23,24,1,31,32,25,26,27,28,29,30)
 # reorder.coef = c(2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,1,31,32,25,26,27,28,29,30))
anexo1 <- texreg(modelos10, center = TRUE,
       custom.coef.names = coefm10,
       custom.model.names = c("(1)","(2)","(1)","(2)","(1)","(2)"),
       dcolumn = TRUE,
       booktabs = TRUE,
       use.packages = FALSE,
       single.row = FALSE,digits = 2,
       sideways = FALSE,
       no.margin = FALSE,scalebox = 0.55,
       caption.above = TRUE,
       custom.note = nota,
       float.pos = "H",
       groups = refm10,
       label = "tab:anexo1b",
       reorder.coef = reorder,
       caption = "Modelos de ecuaciones estructurales para el Estatus Social Subjetivo y Objetivo con las variables latentes \\textit{Salir adelante} (1) y \\textit{Recompensa percibida} (2)")
anexo1
# R.utils::captureOutput(anexo1, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/anexo_ess1.tex")
```

#1. Modelos por orden de hipótesis: Salir Adelante sin controles

```{r sin-controles-sin-NSNR-ordenH1-SALIR-ADELANTE}
modelos9a <- list(m5salir,m4salir,m6salir,m1salir,m33salir,m61salir,m7salir)
coefm9 <- c(
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                      "Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos")

refm9 <- list("\\textbf{Ingresos (ref: Decil 1)}" = 1:9 ,
               "\\textbf{Educación (ref: Primaria incompleta o menos)}"= 10:13,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=14:21)

semSAD <- texreg(modelos9a, center = TRUE,
          custom.coef.names = coefm9,
          custom.model.names = c("Modelo 1","Modelo 2","Modelo 3","Modelo 4","Modelo 5","Modelo 6","Modelo 7"),
          dcolumn = TRUE,
          booktabs = TRUE,
          use.packages = FALSE,
          single.row = FALSE,digits = 3,
          sideways = FALSE,
          no.margin = TRUE,scalebox = 0.65,
          caption.above = TRUE,
          custom.note = nota3,
          float.pos = "!htpb",
          groups = refm9,
          label = "table:semSAD",
          omit.coef = "(IDNR)|(isco_nr)|(ppol_cen)|(ppol_der)|(ppol_ind)|(ppol_ninguno)|(sexo)|(edad)",
          caption = "Modelos de ecuaciones estructurales para el Estatus Social Subjetivo y Objetivo con la variable latente \\textit{Salir adelante} (1)")
semSAD
# R.utils::captureOutput(semSAD, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/semSAD.tex")
```

#2. Modelos por orden de hipótesis: Recompensa percibida sin controles

```{r sin-controles-sin-NSNR-ordenH1-RECOMPENSA-PERCIBIDA}
modelos9b <- list(m5reco,m4reco,m6reco,m1reco,m33reco,m61reco,m7reco)
coefm9 <- c(
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                      "Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos")

refm9 <- list("\\textbf{Ingresos (ref: Decil 1)}" = 1:9 ,
               "\\textbf{Educación (ref: Primaria incompleta o menos)}"= 10:13,
              "\\textbf{Ocupación (ref: Ocupaciones elementales)}"=14:21)

semREC <- texreg(modelos9b, center = TRUE,
          custom.coef.names = coefm9,
          custom.model.names = c("Modelo 1","Modelo 2","Modelo 3","Modelo 4","Modelo 5","Modelo 6"),
          dcolumn = TRUE,
          booktabs = TRUE,
          use.packages = FALSE,
          single.row = FALSE,digits = 3,
          sideways = FALSE,
          no.margin = TRUE,scalebox = 0.65,
          caption.above = TRUE,
          custom.note = nota3,
          float.pos = "!htpb",
          groups = refm9,
          label = "table:semREC",
          omit.coef = "(IDNR)|(isco_nr)|(ppol_cen)|(ppol_der)|(ppol_ind)|(ppol_ninguno)|(sexo)|(edad)",
          caption = "Modelos de ecuaciones estructurales para el Estatus Social Subjetivo y Objetivo con la variable latente \\textit{Recompensa percibida} (2)")
semREC
# R.utils::captureOutput(semREC, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/semREC.tex")
```

# Gráficos

```{r Nombres coeficientes graficos, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
name.coef <- c("Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "No responde - Decil",
                     "Op. de insta/maqu./ensam.",
                     "Ofi., ope. y art",
                     "Agri. y t. calificados",
                     "Servicios, comercio/mercado",
                     "P. apoyo adm.",
                     "Tec y prof. medio",
                     "Prof. cien. e intel",
                     "Directores y gerentes",
                     "No responde - ISCO",
                      "Centro",
                     "Derecha/Centro Derecha",
                     "Independiente",
                     "Ninguno",
                     "Mujer",
                     "Edad")

coef <- c("Estatus Subjetivo propio",
                     "Estatus Subjetivo familia",
                     "Estatus Subjetivo hijos",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Decil 2",
                     "Decil 3",
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "No responde - Decil",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
                     "No responde - ISCO",
                      "Centro",
                     "Derecha/Centro Derecha",
                     "Independiente",
                     "Ninguno",
                     "Mujer",
                     "Edad")
```

```{r mediacion-ess-esshijos}
con3<-'
#modelo de medicion
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
#regresion sobre salir adelante
salirad~c1*ess+essfam+b1*esshijos+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
#regresion sobre recompensa percibida
recompe~c2*ess+essfam+b2*esshijos+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR + isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
esshijos~a*ess
ind1:=a*b1
total1:= c1 + (a*b1)
ind2:=a*b2
total2:= c2 + (a*b2)
ratio1:=ind1/total1
ratio2:=ind2/total2
'
fit.total <-sem(con3,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))
fit.tot.mes <- fitMeasures(fit.total,c("chisq","df","pvalue","cfi","rmsea"))

fit.totalBS <-sem(con3,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"),se="bootstrap", test="bootstrap", bootstrap=1000)


# Efecto indirecto ESS propio pasando por ESS hijos-------
summary(fit.total, standardized = TRUE)
med <- standardizedsolution(fit.total)

med0sa<- med[c(6,640:641,644),]  #salir adelante
med0re<- med[c(38,642:643,645),] #Recompensa
```

```{r Tabla-mediacion-propio-hijos, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
#Mediacion de hijos sobre Salir adelante
tabmed0sa<- texreg::createTexreg(coef.names = med0sa$rhs,
                     coef = med0sa$est.std,
                     se = med0sa$z, 
                     pvalues = med0sa$pvalue)
#Mediacion de hijos sobre Recompensa
tabmed0re<- texreg::createTexreg(coef.names = med0re$rhs,
                     coef = med0re$est.std,
                     se = med0re$z,
                     pvalues = med0re$pvalue)

coefmed <- c("Directo",
             "Indirecto",
             "Total",
             "Ind/Tot",
             "Indirecto",
             "Total",
             "Ind/Tot") 

nota4 <- c("\\parbox{0.5\\linewidth}{\\vspace{2pt} Valores $z$ entre paréntesis  \\\\ 
          $^{***}p<0.001$, $^{**}p<0.01$, $^*p<0.05$. \\\\
          \\textbf{\\textit{Nota}}: Coeficientes de regresión estandarizados.}")
tabmed <- texreg(list(tabmed0sa,tabmed0re),
       float.pos = "!htpb",
       dcolumn = TRUE,
       digits = 2,
       custom.coef.names = coefmed,
       custom.model.names = c("(1)", "(2)"),
       scalebox = 0.5,
       booktabs = TRUE,
       label = "table:med2",
       use.packages = FALSE,
       caption = "Efectos Directos e Indirectos de Estatus subjetivo propio sobre \\textit{Salir Adelante} (1) y \\textit{Recompensa percibida} (2) via Estatus subjetivo de los hijos",
       caption.above = TRUE,
       custom.note = nota4)

tabmed
# R.utils::captureOutput(tabmed, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/mediacion0.tex")
# R.utils::captureOutput(tabmed, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/anexomed2.tex")
```

```{r, essp-sobre-hijos(a)}
medess<- med[c(70),] #Recompensa

#Mediacion de hijos sobre Salir adelante
estessh<- texreg::createTexreg(coef.names = medess$rhs,
                     coef = medess$est.std,
                     se = medess$z, 
                     pvalues = medess$pvalue)
texreg(estessh)

pathb1 <- texreg(estessh,
       custom.model.names = "(b)",
       custom.coef.names = c("Estatus subjetivo propio"),
       float.pos = "H",
       custom.note = nota4,
       scalebox = 1,
       label = "tab:pathb",
       caption = "Estatus subjetivo propio sobre Estatus social subjetivo hijos: (b)",
       caption.above = TRUE,
       booktabs = TRUE,
       use.packages = FALSE,
       dcolumn = TRUE)
# R.utils::captureOutput(pathb1, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/pathb2.tex")
```

```{r mediacion-educ-ess-full, include=FALSE}
elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
con4<-'
#modelo de medicion
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
#regresion sobre salir adelante
salirad~b1*ess+essfam+esshijos+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+
ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
#regresion sobre recompensa percibida
recompe~b2*ess+essfam+esshijos+
ecin1.2+ecin3.4+ecin5+ecin6.7.8+
ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR + isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
#Desde principal a mediador
ess~a11*ecin1.2
ess~a12*ecin3.4
ess~a13*ecin5
ess~a14*ecin6.7.8
#Efecto indirecto
ind1:=a11*b1 
ind2:=a12*b1
ind3:=a13*b1
ind4:=a14*b1
ind5:=a11*b2 
ind6:=a12*b2
ind7:=a13*b2
ind8:=a14*b2
'
fit.total2 <-sem(con4,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))
fit.tot.mes2 <- fitMeasures(fit.total2,c("chisq","df","pvalue","cfi","rmsea"))

summary(fit.total2, standardized = TRUE)
med1 <- standardizedsolution(fit.total2)

# Efecto indirecto pasando por ESS propio-------

med1sa<- med1[c(9:12,643:646),]  #salir adelante
med1re<- med1[c(41:44,647:650),] #Recompensa
```

```{r mediacion-educ-esshijos-full, include=FALSE}
# elsoc_gini$sexo <- as.numeric(elsoc_gini$sexo)
# con5<-'
# #modelo de medicion
# salirad =~d05_02+d05_03+d05_04
# recompe =~c18_09+c18_10
# #regresion sobre salir adelante
# salirad~ess+essfam+b1*esshijos+
# c1*ecin1.2+c11*ecin3.4+c111*ecin5+c1111*ecin6.7.8+
# ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
# #regresion sobre recompensa percibida
# recompe~ess+essfam+b2*esshijos+
# c2*ecin1.2+c22*ecin3.4+c222*ecin5+c2222*ecin6.7.8+
# ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR + isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
# #Desde principal a mediador (a)
# esshijos~a11*ecin1.2
# esshijos~a12*ecin3.4
# esshijos~a13*ecin5
# esshijos~a14*ecin6.7.8
# #Efecto indirecto (a*b)
# ind1:=a11*b1 
# ind2:=a12*b1
# ind3:=a13*b1
# ind4:=a14*b1
# total1a:= c1   + (a11*b1)
# total1b:= c11  + (a12*b1)
# total1c:= c111 + (a13*b1)
# total1d:= c111 + (a14*b1)
# ind5:=a11*b2 
# ind6:=a12*b2
# ind7:=a13*b2
# ind8:=a14*b2
# total2a:= c2    + (a11*b2)
# total2b:= c22   + (a12*b2)
# total2c:= c222  + (a13*b2)
# total2d:= c2222 + (a14*b2)
# ratio1:=ind1/c1  
# ratio2:=ind2/c11 
# ratio3:=ind3/c111
# ratio4:=ind4/c111
# ratio5:=ind5/c2   
# ratio6:=ind6/c22  
# ratio7:=ind7/c222 
# ratio8:=ind8/c2222
# '

con5<-'
#modelo de medicion
salirad =~d05_02+d05_03+d05_04
recompe =~c18_09+c18_10
#regresion sobre salir adelante
salirad~ess+essfam+b1*esshijos+
c1*ecin1.2+c11*ecin3.4+c111*ecin5+c1111*ecin6.7.8+
ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR+isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
#regresion sobre recompensa percibida
recompe~ess+essfam+b2*esshijos+
c2*ecin1.2+c22*ecin3.4+c222*ecin5+c2222*ecin6.7.8+
ID02+ID03+ID04+ID05+ID06+ID07+ID08+ID09+ID10+IDNR + isco08+isco07+isco06+isco05+isco04+isco03+isco02+isco01+isco_nr+ ppol_cen+ppol_der+ppol_ind+ppol_ninguno+ sexo + edad
#Desde principal a mediador (a)
esshijos~a11*ecin1.2
esshijos~a12*ecin3.4
esshijos~a13*ecin5
esshijos~a14*ecin6.7.8
#Efecto indirecto (a*b)
ind1:=a11*b1 
ind2:=a12*b1
ind3:=a13*b1
ind4:=a14*b1
total1a:= c1   + (a11*b1)
total1b:= c11  + (a12*b1)
total1c:= c111 + (a13*b1)
total1d:= c111 + (a14*b1)
ind5:=a11*b2 
ind6:=a12*b2
ind7:=a13*b2
ind8:=a14*b2
total2a:= c2    + (a11*b2)
total2b:= c22   + (a12*b2)
total2c:= c222  + (a13*b2)
total2d:= c2222 + (a14*b2)
ratio1:=ind1/total1a
ratio2:=ind2/total1b
ratio3:=ind3/total1c
ratio4:=ind4/total1d
ratio5:=ind5/total2a
ratio6:=ind6/total2b
ratio7:=ind7/total2c
ratio8:=ind8/total2d
'

fit.total3 <-sem(con5,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))
# fit.total3b <-sem(con5b,data=elsoc_gini,ordered=c("d05_02","d05_03","d05_04","c18_09","c18_10"))

fit.tot.mes3 <- fitMeasures(fit.total3,c("chisq","df","pvalue","cfi","rmsea"))

fit.totalBS <-sem(con5,data=elsoc_gini, se="bootstrap", test="bootstrap", bootstrap=1000)


summary(fit.total3, standardized = TRUE)
summary(fit.total3b, standardized = TRUE)

summary(fit.totalBS, standardized = TRUE) #usando bootstrap

med2  <- standardizedsolution(fit.total3)
med2b <- standardizedsolution(fit.totalBS)
inspect(fit.total3, 'r2')

# Efecto indirecto pasando por ESS hijos-------

# med2sa<- med2[c(9:12,643:646,647:650),]  #salir adelante
# med2re<- med2[c(41:44,651:654,655:658),] #Recompensa 

med2sa<- med2[c(9:12,643:646,647:650,659:662),]  #salir adelante
med2re<- med2[c(41:44,651:654,655:658,663:666),] #Recompensa 
```

```{r}
ind1           <-   0.008
ind2           <-   0.003
ind3           <-  -0.000
ind4           <-  -0.002
total1a        <-   0.109
total1b        <-   0.149
total1c        <-   0.171
total1d        <-   0.170
ind5           <-  -0.004
ind6           <-  -0.001
ind7           <-   0.000
ind8           <-   0.001
total2a        <-  -0.080
total2b        <-  -0.165
total2c        <-  -0.210
total2d        <-  -0.188

(ind1/total1a)*100
(ind2/total1b)*100
(ind3/total1c)*100
(ind4/total1d)*100

(ind5/total2a)*100
(ind6/total2b)*100
(ind7/total2c)*100
(ind8/total2d)*100
```

```{r Tabla-mediacion-hijos, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
#Mediacion de hijos sobre Salir adelante
tabmed1sa<- texreg::createTexreg(coef.names = med2sa$rhs,
                     coef = med2sa$est.std,
                     se = med2sa$z, 
                     pvalues = med2sa$pvalue)
#Mediacion de hijos sobre Recompensa
tabmed1re<- texreg::createTexreg(coef.names = med2re$rhs,
                     coef = med2re$est.std,
                     se = med2re$z,
                     pvalues = med2re$pvalue)

coefmed <- c("Primaria o secundaria baja", 
             "Secundaria alta", 
             "Terciaria ciclo corto", 
             "Terciaria y Postgrado",
             "Ind: Primaria o secundaria baja", 
             "Ind: Secundaria alta", 
             "Ind: Terciaria ciclo corto", 
             "Ind: Terciaria y Postgrado", 
             "Total (Primaria o secundaria baja)",
             "Total (Secundaria alta)",
             "Total (Terciaria ciclo corto)",
             "Total (Terciaria y Postgrado)",
             "Ind/Total: (Primaria o secundaria baja)",
             "Ind/Total: (Secundaria alta)",
             "Ind/Total: (Terciaria ciclo corto)",
             "Ind/Total: (Terciaria y Postgrado)",
             "Ind: Primaria o secundaria baja", 
             "Ind: Secundaria alta", 
             "Ind: Terciaria ciclo corto", 
             "Ind: Terciaria y Postgrado", 
             "Total (Primaria o secundaria baja)",
             "Total (Secundaria alta)",
             "Total (Terciaria ciclo corto)",
             "Total (Terciaria y Postgrado)",
             "Ind/Total: (Primaria o secundaria baja)",
             "Ind/Total: (Secundaria alta)",
             "Ind/Total: (Terciaria ciclo corto)",
             "Ind/Total: (Terciaria y Postgrado)") 

gruposmed <- list("\\textbf{Directo (ref: Primaria incompleta o menos)}" = 1:4,
              "\\textbf{Indirecto (a*b):}" = 5:8,
              "\\textbf{Total (c + (a*b)):}" = 9:12,
              "\\textbf{Ratio:}" =13:16)

nota4 <- c("\\parbox{0.5\\linewidth}{\\vspace{2pt} Valores $z$ entre paréntesis  \\\\ 
          $^{***}p<0.001$, $^{**}p<0.01$, $^*p<0.05$. \\\\
          \\textbf{\\textit{Nota}}: Coeficientes de regresión estandarizados.}")
anexo2 <- texreg(list(tabmed1sa,tabmed1re),
       float.pos = "!htpb",
       dcolumn = TRUE,
       digits = 2,
       custom.coef.names = coefmed,
       custom.model.names = c("(1)", "(2)"),
       scalebox = 0.5,
       booktabs = TRUE,
       label = "table:med1",
       use.packages = FALSE,
       groups = gruposmed,
       caption = "Efectos Directos e Indirectos de Educación sobre \\textit{Salir Adelante} (1) y \\textit{Recompensa percibida} (2) via Estatus subjetivo de los hijos (Completo)",
       caption.above = TRUE,
       custom.note = nota4)

anexo2
R.utils::captureOutput(anexo2, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/anexomed.tex")
```

```{r}
med2edu <- med2[70:73,]
educess<- texreg::createTexreg(coef.names = med2edu$rhs,
                     coef = med2edu$est.std,
                     se = med2edu$z,
                     pvalues = med2edu$pvalue)

pathb <- texreg(educess,
       custom.model.names = "(b)",
       custom.coef.names = c("Primaria o secundaria baja","Secundaria alta","Terciaria ciclo corto", "Terciaria y Postgrado"),
       float.pos = "H",
       custom.note = nota4,
       scalebox = 1,
       label = "tab:pathb",
       caption = "Educación sobre Estatus social subjetivo hijos: (b)",
       caption.above = TRUE,
       booktabs = TRUE,
       use.packages = FALSE,
       dcolumn = TRUE)
pathb
# R.utils::captureOutput(pathb, file = "C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/4. Latex Tesis/segundo-semestre/tables/pathB.tex")
```

```{r Gráficos coeficientes(COMPLETOS), eval=FALSE, include=FALSE}
salirad.est <- as.data.frame(parameterEstimates(fit.sem)[c(6:21,23:30),])
recompe.est <- as.data.frame(parameterEstimates(fit.sem)[c(38:53,55:62),])
s1est <- salirad.est
r1est <- recompe.est

a <- c("ess","essfam","esshijos","ecin1.2","ecin3.4","ecin5","ecin6.7.8","ID02","ID03","ID04","ID05","ID06","ID07","ID08","ID09","ID10","IDNR","isco08","isco07","isco06","isco05","isco04","isco03","isco02","isco01","isco_nr","ppol_cen","ppol_der","ppol_ind","ppol_ninguno","sexo","edad")        
        
# Gráfico coeficientes Salir adelante  --------------------------------------------------------

texreg::coefplot(labels = name.coef,
                 estimates = s1est$est,
                 lower.outer = s1est$ci.lower,
                 upper.outer = s1est$ci.upper,main = "Salir adelante",
                 xlab = "Coeficientes no estandarizados",
                 cex = 2,
                 lwd.outer = 3,
                 xlim = c(-0.5,0.5))

  
library(ggplot2)

s1est$sig05 <- as.numeric(s1est$pvalue<0.05)
s1est$sig01 <- as.numeric(s1est$pvalue<0.01)
s1est$sig001 <- as.numeric(s1est$pvalue<0.001)

s1est$sig <- 0
s1est$sig[s1est$sig =='NA'] <- 0
s1est$sig[s1est$sig05 ==1] <- 1
s1est$sig[s1est$sig01 ==1] <- 2
s1est$sig[s1est$sig001==1] <- 3
s1est$sig <- factor(s1est$sig, ordered = T)

s1est$rhs <- factor(s1est$rhs, ordered = TRUE,levels = a, labels =coef)
pd <- position_dodge(width=0.25)

ggplot(s1est,aes(y = rhs,x = est, color=sig)) +
  geom_point(size = 2, position = pd) +
  geom_errorbarh(aes(xmin = ci.lower, xmax= ci.upper), height=0.5, position = pd)+
  scale_y_discrete(name =" ",limits = rev(levels(s1est$rhs)))+
  scale_color_manual(values = c("grey","black","blue","purple"), labels = c("p>.05","p<.05","p<.01","p<.001"), name ="")+
  geom_vline(xintercept=c(0), color ="red")+
  scale_x_continuous(name="Coeficiente no estandarizado", breaks = seq(-0.4, 0.5, by = 0.1), limits = c(-0.4,0.5))+
  theme_bw() + 
  theme(legend.position = "bottom")+
  ggtitle("Variable latente Salir adelante")
ggsave("C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/Presentaciones/presentacion-final/coef1.jpg",dpi = 320,units = "cm", width = 28, height = 20)


# Gráfico coeficientes Recompensa percibida --------------------------------------------------------

texreg::coefplot(labels = s1est$rhs,estimates = r1est$est,
                 lower.outer = r1est$ci.lower,
                 upper.outer = r1est$ci.upper,main = "Recompensa percibida")

r1est$sig05 <- as.numeric(r1est$pvalue<0.05)
r1est$sig01 <- as.numeric(r1est$pvalue<0.01)
r1est$sig001 <- as.numeric(r1est$pvalue<0.001)
r1est$sig <- 0
r1est$sig[r1est$sig =='NA']  <- 0
r1est$sig[r1est$sig05 ==1] <- 1
r1est$sig[r1est$sig01 ==1] <- 2
r1est$sig[r1est$sig001==1] <- 3
r1est$sig <- factor(r1est$sig, ordered = T)
r1est$rhs <- factor(r1est$rhs, ordered = TRUE,levels = a, labels =coef) 
# Ggplot-----------------
ggplot(r1est,aes(y = rhs,x = est, color=sig)) +
  geom_point(size = 2, position = pd) +
  geom_errorbarh(aes(xmin = ci.lower, xmax= ci.upper), height=0.2, position = pd)+
  scale_y_discrete(name =" ",limits = rev(levels(r1est$rhs)))+
  scale_color_manual(values = c("grey","black","blue","purple"),labels = c("p>.05","p<.05","p<.01","p<.001"), name ="")+
  geom_vline(xintercept=c(0), color ="red")+
  scale_x_continuous(name="Coeficiente no estandarizado", breaks = seq(-0.8, 0.8, by = 0.1), limits = c(-0.8,0.8))+
  theme_bw()+
  theme(legend.position = "bottom")+
  ggtitle("Variable latente Recompensa percibida")
ggsave("C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/Presentaciones/presentacion-final/coef2.jpg",dpi = 320,units = "cm", width = 28, height = 20)
```

```{r Gráficos coeficientes(SIN CONTROLES), eval=FALSE, include=FALSE}
salirad.est <- as.data.frame(parameterEstimates(fit.sem)[c(6:14,16:27,29:31),])
recompe.est <- as.data.frame(parameterEstimates(fit.sem)[c(38:46,48:59,61:63),])
s1est <- salirad.est
r1est <- recompe.est
s1est$hipo <- car::recode(var = s1est$rhs, "c('ID02','ID03','ID04','ID05','ID06','ID07','ID08','ID09','ID10')='H1a';
                          c('ecin1.2','ecin3.4','ecin5','ecin6.7.8')='H1b';
                          c('isco08','isco07','isco06','isco05','isco04' ,'isco03','isco02','isco01')='H1c';
                          'ess'='H2a';
                          'essfam'='H2b';
                          'esshijos'='H2c'") 

r1est$hipo <- car::recode(var = s1est$rhs, "c('ID02','ID03','ID04','ID05','ID06','ID07','ID08','ID09','ID10')='H1a';
                          c('ecin1.2','ecin3.4','ecin5','ecin6.7.8')='H1b';
                          c('isco08','isco07','isco06','isco05','isco04' ,'isco03','isco02','isco01')='H1c';
                          'ess'='H2a';
                          'essfam'='H2b';
                          'esshijos'='H2c'")



a <- c("ID02","ID03","ID04","ID05","ID06","ID07","ID08","ID09","ID10","ecin1.2","ecin3.4","ecin5","ecin6.7.8","isco08","isco07","isco06","isco05","isco04","isco03","isco02","isco01","ess","essfam","esshijos")


# Gráfico coeficientes Salir adelante  --------------------------------------------------------

coef <- c(           "Decil 2",
                     "Decil 3", 
                     "Decil 4",
                     "Decil 5",
                     "Decil 6",
                     "Decil 7",
                     "Decil 8",
                     "Decil 9",
                     "Decil 10",
                     "Primaria y secundaria baja",
                     "Secundaria alta",
                     "Terciaria ciclo corto",
                     "Terciaria y Postgrado",
                     "Operadores de instalaciones/maquina/ensamblaje",
                     "Oficiales, operarios y artesanos",
                     "Agricultores y trabajadores calificados",
                     "Servicios y vendedores de comercios y mercados",
                     "Personal de apoyo administrativo",
                     "Técnicos y profesionales de nivel medio",
                     "Profesionales científicos e intelectuales",
                     "Directores y gerentes",
          "Estatus Subjetivo propio",
             "Estatus Subjetivo familia",
              "Estatus Subjetivo hijos")

s1est$sig05 <- as.numeric(s1est$pvalue<0.05)
s1est$sig01 <- as.numeric(s1est$pvalue<0.01)
s1est$sig001<- as.numeric(s1est$pvalue<0.001)
s1est$sig00 <- as.numeric(s1est$pvalue>0.05)

s1est$sig[s1est$sig00 ==1] <- 1
s1est$sig[s1est$sig05 ==1] <- 2
s1est$sig[s1est$sig01 ==1] <- 3
s1est$sig[s1est$sig001==1] <- 4
s1est$sig <- factor(s1est$sig, levels = c(1,2,3,4),ordered = T)

s1est$rhs <- factor(s1est$rhs, ordered = TRUE,levels = a, labels =coef)
pd <- position_dodge(width=0.25)

ggplot(s1est,aes(y = rhs,x = est, color=sig)) +
  geom_point(size = 2, position = pd) +
  geom_errorbarh(aes(xmin = ci.lower, xmax= ci.upper), height=0.5, position = pd)+
  scale_y_discrete(name =" ",limits = rev(levels(s1est$rhs)))+
  scale_color_manual(values = c("grey","black","purple"), labels = c("p>.05","p<.05","p<.001"), name ="")+
  geom_vline(xintercept=c(0), color ="red")+
  scale_x_continuous(name="Coeficiente no estandarizado", breaks = seq(-0.4, 0.5, by = 0.1), limits = c(-0.4,0.5))+
  theme_bw() +
  theme(legend.position = "bottom")
  
ggsave("C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/5. Defensa/images/coef_sad.pdf",dpi = 320,units = "cm", width = 28, height = 20)


# Gráfico coeficientes Recompensa percibida --------------------------------------------------------

texreg::coefplot(labels = s1est$rhs,estimates = r1est$est,
                 lower.outer = r1est$ci.lower,
                 upper.outer = r1est$ci.upper,main = "Recompensa percibida")

r1est$sig05 <- as.numeric(r1est$pvalue<0.05)
r1est$sig01 <- as.numeric(r1est$pvalue<0.01)
r1est$sig001<- as.numeric(r1est$pvalue<0.001)
r1est$sig00 <- as.numeric(r1est$pvalue>0.05)
r1est$sig[r1est$sig00 ==1] <- 1
r1est$sig[r1est$sig05 ==1] <- 2
r1est$sig[r1est$sig01 ==1] <- 3
r1est$sig[r1est$sig001==1] <- 4
r1est$sig <- factor(r1est$sig, levels = c(1,2,3,4),ordered = T)
r1est$rhs <- factor(r1est$rhs, ordered = TRUE,levels = a, labels =coef) 
# Ggplot-----------------
ggplot(r1est,aes(y = rhs,x = est, color=sig)) +
  geom_point(size = 2, position = pd) +
  geom_errorbarh(aes(xmin = ci.lower, xmax= ci.upper), height=0.2, position = pd)+
  scale_y_discrete(name =" ",limits = rev(levels(r1est$rhs)))+
  scale_color_manual(values = c("grey","blue","purple"),labels = c("p>.05","p<.01","p<.001"), name ="")+
  geom_vline(xintercept=c(0), color ="red")+
  scale_x_continuous(name="Coeficiente no estandarizado", breaks = seq(-0.8, 0.8, by = 0.1), limits = c(-0.8,0.8))+
  theme_bw()+
  theme(legend.position = "bottom")
ggsave("C:/Users/JC/Google Drive/1.Magister/2. Segundo año/Tesis Magister/Primer Semestre/5. Defensa/images/coef_rec.pdf",dpi = 320,units = "cm", width = 28, height = 20)
```


